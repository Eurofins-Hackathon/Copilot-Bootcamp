# Navigating the Code Clouds: Advanced Features of GitHub Copilot 
This lab exercise delves into GitHub Copilot's advanced features, teaching participants to enhance coding efficiency through complex tasks like adding new properties, generating documentation, refactoring code, and parsing strings, supplemented by optional labs on context understanding and regex parsing.

## Prerequisites
- The prerequisites steps are completed, see [Labs Prerequisites](https://github.com/XpiritBV/Copilot-Bootcamp#labs-prerequisites)

## Estimated time to complete
- 30 min

## Objectives
- To master GitHub Copilot's advanced features for solving complex coding exercises and optimizing code.

### Step 1: - The Complete Wright Brothers Fleet

- Open the `Plane.cs` file located in the `Models` folder.

- Add a `ImageUrl` property to the model.

- Type `public string ImageUrl { get; set; }` in the `Plane.cs` file.

```csharp
public class Plane
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Year { get; set; }
    public string Description { get; set; }
    public int RangeInKm { get; set; }

    // New property
    public string ImageUrl { get; set; }
}
```

- Open the `PlanesController.cs` file.

- Select all content of the `Planes` List.

<img src="/Images/Screenshot123719.png" width="800">

- Right click and select the option `Copilot` -> `Start Inline Chat`.

- Type the following command

    ```
    Add the new ImageUrl property and complete the Wright Brothers Fleet
    ```

<img src="/Images/Screenshot124031.png" width="800">

- Accept the suggestion by selecting `Accept` or pressing `Enter`.

>[!Note]
> GitHub Copilot can do more than one thing at a time. It added the new property and filled in the list of planes.

### Step 2: - Flight Logbook - Logging Your Coding Journey

- Open the `PlanesController.cs` file.

- Select all content of the `PlanesController.cs` file.

- Right click and choose for the option `Copilot` -> `Generate Docs`.

TODO:  [Screenshot] - Select all - Right click - Generate Docs

<img src="/Images/placeholderSmall.png" width="800">

- Accept the suggestion by selecting `Accept`.

TODO:  [Screenshot] - Accept
<img src="/Images/placeholderSmall.png" width="800">
<img src="/Images/placeholderSmall.png" width="800">


> [!Note]
> GitHub Copilot used the `/docs` agent to generate the documentation for the entire file in a matter of seconds.

### Step 3: - Flying in Formation - Pair Programming with Copilot

- Open the `WrightBrothersApi/Controllers/FlightsController.cs` file.

- Navigate to the `UpdateFlightStatus` method.

> [!Note]
> Note that the `UpdateFlightStatus` method has a high code complexity rating of 8.

- Select all the content of the `UpdateFlightStatus` method.

- Open the Copilot Chat extension.

- Ask the following question:

    ```
    Refactor the selected code to make it more readable and maintainable.
    ```

> [!Note]
> GitHub Copilot Chat understands `the selected code`. It will use the selected code in your editor to generate the refactoring suggestions.

> Copilot Chat: "The current code is a bit lengthy and has a lot of conditional statements. We can refactor it by extracting the validation logic into separate methods. This will make the code more readable and maintainable. Here's how we can do it:"

> [!Note]
> To make it more readable and maintainable, Copilot will suggest to extract the code into a separate method, appying the Single Responsibility Principle of the SOLID principles.

> [!Note]
> Note that GitHub Copilot Chat can make mistakes sometimes. Best practice is to have the method covered with unit tests before refactoring it. This is not a requirement for this lab, but it is a good practice to follow. These unit tests can be generated by GitHub Copilot as well, which is covered in a previous lab.

### Step 4: - Parsing Flight Show - String parsing

- Open the `WrightBrothersApi/Models/Flight.cs` file.

- Take a look at the `FlightLogSignature` property.

    ```csharp
    public class Flight
    {
        // Other properties
        // ...

        // Format: DDMMYY-DEP-ARR-FLIGHT
        // Example: 17121903-DEP-ARR-WB001
        // For this flight
        // 17th of December 1903
        // Departure from Kitty Hawk, NC
        // Arrival at Manteo, NC
        // Flight number WB001
        public string FlightLogSignature { get; set; }
    }
    ```

> [!Note]
> Note that the `FlightLogSignature` is a fictional property that is used to demonstrate the capabilities of GitHub Copilot. It is not a real aviation concept.

- Select all the content of the `FlightLogSignature` property and its description.

// TODO UPDATE SCREENSHOT

    ![Image of TBD](/Images/Screenshot125047.png)

- Open the Copilot Chat extension and ask the following question:

    ```
    Create a c# record with a Parse method for the selected FlightLogSignature property. The Date must be a DateTime.
    ```

> [!Note]
> Note the prompt engineering for the 19th century context. This is a good example of how to instruct Copilot to generate code that is in line with the context of the application.

- Copilot will suggest a new `FlightLog` record type and a `Parse` method. The `Parse` method splits the string and assigns each part to a corresponding property.


    ```csharp
    // Make sure to add the System.Globalization namespace
    using System.Globalization;

    public record FlightLog
    {
        public DateTime Date { get; init; }
        public string Departure { get; init; }
        public string Arrival { get; init; }
        public string FlightNumber { get; init; }

        public static FlightLog Parse(string flightLogSignature)
        {
            var parts = flightLogSignature.Split('-');
            if (parts.Length != 4){
                throw new ArgumentException("Invalid flight log signature format.");
            }
         
            var dateString = parts[0];
            var date = DateTime.ParseExact(dateString, "ddMMyyyy", CultureInfo.InvariantCulture);

            return new FlightLog
            {
                Date = date,
                Departure = parts[1],
                Arrival = parts[2],
                FlightNumber = parts[3]
            };
        }
    }
    ```

> [!Note]
> A C# record type is a reference type that provides built-in functionality for encapsulating data. It is a reference type that is similar to a class, but it is immutable by default. It is a good choice for a simple data container.

> [!Note]
> GitHub Copilot is very good at understanding the context of the code. It understands that the `FlightLogSignature` is a string in a specific format and that it can be parsed into a `FlightLogSignature` model, to make the code more readable and maintainable.

- In the Copilot Chat extension window, press the button to insert the suggested `FlightLog` record as a new file into `WrightBrothersApi/Models/FlightLog.cs`.

    <img src="/Images/placeholderSmall.png" width="800">

> [!Note]
> GitHub Copilot has many quick actions that can be used to speed up the development process. In this case, it pasted the suggested code on the cursor in the editor. 

- Now, let's add the new `FlightLog` property to the `Flight` model.

- Open the `Flight.cs` file.

- Add the `FlightLog` property to the `Flight` model.

    ```csharp
    public class Flight
    {
        // Other properties
        // ...

        // Existing property
        public string FlightLogSignature { get; set; }

        // New property
        public FlightLog FlightLog { get; set; }
    }
    ```

TODO: MAybe Copilot will do this, because we did the previous steps to add the FlightLog to the Flight model.

- Open the `FlightsController.cs` file.

- Navigate to the `Post` method.

- Add the following code to `Parse` the `FlightLogSignature` property to the .

// TODO: Maybe Copilot will do this, because we did the previous steps to add the FlightLog to the Flight model.

    ```csharp

    public class FlightsController : ControllerBase
    {
        /* Rest of the methods */

        [HttpPost]
        public ActionResult<Flight> Post(Flight flight)
        {
            // Rest of the method

            <------ Place cursor here 

            Flights.Add(flight);

            return CreatedAtAction(nameof(GetById), new { id = flight.Id }, flight);
        }

    }
    ```

- Type the following at the cursor

    ```csharp
    var flightLog
    ```

- Copilot will suggest the following code

    ```csharp
    var flightLog = FlightLog.Parse(flight.FlightLogSignature);
    ```

- Now press `Tab` to accept the suggestion.

- Now press `Enter` and Copilot will suggest the following code:

    ```csharp
    flight.FlightLog = flightLog;
    ```

> [!Note]
> As explained in an earlier lab, Copilot used the new created `FlightLog.cs` file in its context and suggests the `FlightLog.Parse` method.

- Now, run the app and test the new functionality.

    ```bash
    dotnet run
    ```

- Open `Flights.http` file in the Visual Studio code IDE and POST a new flight.

    // TODO SCREENSHOT


- The Rest Client response will now include the `FlightLog` property as follows:

    ```json
    {
        "id": 4,
        "flightLogSignature": "17091908-DEP-ARR-WB004",
        "flightLog": {
            "date": "1908-09-17T00:00:00",
            "departure": "DEP",
            "arrival": "ARR",
            "flightNumber": "WB004"
        },
    }
    ```

    // TODO SCREENSHOT

## Optional

### Step 5: - Regex Aerobatics Show - Regular Expressions

- Open the `Flight.cs` file.

- Start by adding the `AerobaticSequenceSignature` property to the `Flight.cs` file.

    ```csharp
    public class Flight
    {
        
        // Other properties
        //
        // ...
        // 
        // Encodes a series of aerobatic maneuvers
        // L = Loop, H = Hammerhead, R = Roll, S = Spin, T = Tailslide
        // Number represents repeat count, 
        // Letter represents difficulty (A-E)
        // Example 1: L4B-H2C-R3A-S1D-T2E
        // Example 2: L1A-H1B-R1C-S1D-T1E
        public string AerobaticSequenceSignature { get; set; }
    }

    ```

> [!Note]
> Note that the `AerobaticSequenceSignature` is a fictional property that is used to demonstrate the capabilities of GitHub Copilot. It is not a real aviation concept.

- Select all the content of the `AerobaticSequenceSignature` property and its description.

    ![Image of TBD](/Images/Screenshot134718.png)

- Open the Copilot Chat extension and ask the following question:

```
Parse the selected AerobaticSequenceSignature property into c# models using a regex expression. Create a AerobaticSequence class that inherits a List of Manouvers. Manouver can be a public class inside the AerobaticSequence class.
```

- Copilot will suggest the following `AerobaticSequence` class:

    ```csharp
    using System;
    using System.Collections.Generic;
    using System.Text.RegularExpressions;

    public class AerobaticSequence : List<Maneuver>
    {
        private class Maneuver
        {
            public string Type { get; set; }
            public int RepeatCount { get; set; }
            public string Difficulty { get; set; }
        }

        public AerobaticSequence(string sequence)
        {
            var regex = new Regex(@"([A-Z])(\d+)([A-E])");
            var matches = regex.Matches(sequence);

            foreach (Match match in matches)
            {
                var maneuver = new Maneuver
                {
                    Type = match.Groups[1].Value,
                    RepeatCount = int.Parse(match.Groups[2].Value),
                    Difficulty = match.Groups[3].Value
                };

                this.Add(maneuver);
            }
        }
    }
    ```

> [!Note]
> We prompt engineered the `AerobaticSequence` class to instruct Copilot to generate a very specific solution.

- In the Copilot Chat extension window, press the button to insert the suggested `AerobaticSequence` class as a new file into `WrightBrothersApi/Models/AerobaticSequence.cs`.

- Copilot sometimes makes a mistake with the Manouver reference in the `List<Maneuver>` class.

- Ofcourse, you can use Copilot to fix this. First open the `AerobaticSequence.cs` file.

- Now open the Copilot Chat extension and ask the following question:

    ```
    @workspace /fix
    ```

- Copilot will suggest to change `List<Maneuver>` with `List<AerobaticSequence.Maneuver>`.    

TODO: Copy/paste the steps from the previous lab.